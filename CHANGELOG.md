# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html),
and is generated by [Changie](https://github.com/miniscruff/changie).

## v1.40.2 - 2023-03-03

### 🔨 Refactor

- Allow defining command handlers which could return an error instead of exit code.
- Move store package to internal/store. Do not use custom ApiError in the store package.
- Reduce number of API calls in E2E tests by using CLI configuration profile instead of requesting a new token on each CLI run.

### 🐛 Bug Fix

- Remove "v" prefix from https://dsv.secretsvaultcloud.com/cli-version.json which causes error messages in log.

### Contributors

- [andrii-zakurenyi](https://github.com/andrii-zakurenyi)
- [mariiatuzovska](https://github.com/mariiatuzovska)

## v1.40.1 - 2023-02-07

### 🎉 Feature

- CLI can be invoked through a container now.
  See [Docker Hub](https://hub.docker.com/r/delineaxpm/dsv-cli) for available versions.
  Examples are listed on README.md on how to use in shell as well as an example convenience wrapper.

### 🐛 Bug Fix

- DSV init will now error when the filestore path is not a directory.

### Related

- fixes AB#464525
- fixes AB#473745
- related AB#484003

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.40.0 - 2023-02-01

### 🎉 Feature

- `dsv byok update`: new command which allows to change master encryption key. See `dsv byok update --help` for more details.
- `dsv engine list`: new `--query, -q`, `--pool-name`, `--sort`, `--sorted-by` flags. See `dsv engine list --help` for more details.
- `dsv pool list`: new `--query, -q`, `--sort`, `--sorted-by` flags. See `dsv pool list --help` for more details.
- `dsv role search`: new `--sort`, `--sorted-by` flags. See `dsv role search --help` for more details.
- `dsv client search`: new `--sort` flag allows to sort client credentials by created time.
- `dsv user groups`: new `--query, -q`, `--limit`, `--cursor`, `--sort` flags. See `dsv user groups --help` for more details.
- `dsv groups search`: new `--sort`, `--sorted-by` flags See `dsv groups search --help` for more details.
- `dsv user search`: new `--sort`, `--sorted-by` flags. See `dsv user search --help` for more details.
- `dsv policy search`: new `--sort`, `--sorted-by` flags. See `dsv policy search --help` for more details.

### 🐛 Bug Fix

- Fix reading file with cached latest available cli version. Store only one download link for a corresponding os/arch.
- Use endpoint prompting only when selected transport protocol is either HTTP or HTTPS for `dsv siem create`.
- Delete engine without useless force flag.

### 🤖 CI

- Use new Delinea DSV Azure DevOps Task instead of deprecated ThycoticDSV.

### 🤖 Development

- Devcontainer attempts to mount existing dsv cli configuration from filestore if this is available.
  This will ease local devcontainer usage setup and allow testing and `$HOME/.envrc` configurations to be autoloaded.

### Related

- fixes AB#481685
- fixes AB#481686
- fixes AB#481687
- fixes AB#481688
- fixes AB#481928
- fixes AB#481929
- fixes AB#481930
- fixes AB#482144
- fixes AB#482527
- fixes AB#482447
- fixes AB#482320
- fixes AB#482838
- fixes AB#468104
- related AB#481683
- related AB#470745
- related AB#482427
- related AB#481124
- related AB#468923

### Contributors

- [mariiatuzovska](https://github.com/mariiatuzovska)
- [sheldonhull](https://github.com/sheldonhull)

## v1.39.13 - 2023-01-06

No user facing impact.
This release is iterating on Snap installation method for Linux (which is in progress), and does not impact functionality of the dsv-cli.

### 🔨 Refactor

- Remove plugs for the dsv-cli snap installation, allowing all configuration to sit inside the isolated snap environment.

### Related

- fixes AB#480396
- related AB#464526

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.12 - 2023-01-05

No user facing impact.
This release is iterating on Snap installation method for Linux (which is in progress), and does not impact functionality of the dsv-cli.

### 🐛 Bug Fix

- Adjust snap installation mapping by removing aliases in goreleaser config.

### Related

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.11 - 2023-01-05 <!-- v3 -->

No user facing impact.
This release is iterating on Snap installation method for Linux (which is in progress), and does not impact functionality of the dsv-cli.

### 🐛 Bug Fix

- Adjust snap installation mapping in goreleaser to try and ensure publishing is successful.

### Related

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.10 - 2023-01-04 <!-- v5 -->

### 🎉 Feature

- Add new installation method for Linux users, leveraging Snapcraft.
  Include Snap install support for goreleaser, with login tasks and release tasks for Mage and Azure Pipelines included now. and login tasks for snapcraft.

### Related

- fixes AB#480396
- related AB#464526

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.9 - 2023-01-03

### 🎉 Feature

- Release Scoop Installation support. This will allow Windows users to install via Scoop, which is a similar experience to Homebrew on MacOS and Linux.

### Related

- fixes AB#477843
- related AB#464528

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.8 - 2022-12-16

### 🐛 Bug Fix

- Reverted Scoop installation method as this is failing despite builds for windows at this time.
  Will revisit in the future as might be a Goreleaser issue or problem identifying the assets built in this more complex configuration.

### Related

- related AB#464528

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.7 - 2022-12-16

### 🎉 Feature

- Add Scoop installation method for Windows.

### Related

- fixes AB#477843
- related AB#464528

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.6 - 2022-12-16

### 🔨 Refactor

- Adjust the artifact path for goreleaser generated checksum back to standard asset-platform-etc.

### Related

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.5 - 2022-12-15

### 🐛 Bug Fix

- Resolve version of binary and asset matching for update service with cli-version.json and brew installs.

### Related

- fixes AB#478048

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.4 - 2022-12-15

### 🐛 Bug Fix

- Ensure embedded version information is correctly included in binary. This was missing from prior release returning "undefined".

### Related

- related AB#464524

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.3 - 2022-12-15

### 🐛 Bug Fix

- Improve Homebrew installation support for multiple architectures on macOS.

### Related

- related AB#464524

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.2 - 2022-12-15

### 🎉 Feature

- 🎉 Brew install is now available for macOS and Linux.
- Add `--name` flag instead of `--path` flag for read/update/delete SIEM.
  While we'll continue to support `--path` flag, you should use `--name` flag primarly.

### 🐛 Bug Fix

- Remove `--name` flag check while using `--data` flag on create siem.
- Trim space in name on create siem.

### Related

- fixes AB#471546
- fixes AB#477843
- fixes AB#475389
- fixes AB#471545
- related AB#464524
- related AB#477345
- related AB#477323

### Contributors

- [sheldonhull](https://github.com/sheldonhull)
- [mariiatuzovska](https://github.com/mariiatuzovska)
- [andrii-zakurenyi](https://github.com/andrii-zakurenyi)

## v1.39.1 - 2022-11-14

<!--v2-->

For users, the primary difference in this release is improved documentation in the project repo and a few new release artifacts.

For developers, this contains a lot of changes related to CI, development workflow improvements, and more. Yes, the wait is over! 🎉

### 🎉 Feature

- Release process primarily handled by the great [GoReleaser](https://goreleaser.com/).
- Release local and remote both invoked easily via: `mage release:all` task.
  This includes cross-platform builds, signing, publishing to s3, github release creation, SBOM creation, and more.
  - This lays the groundwork for additional installation methods, such as `brew`, that will be coming soon.
- Release artifacts now include software bill of materials, signature files from cosign for asset verification.
- [Aqua-proj](https://aquaproj.github.io/) now points to this new repo location.
- `README.md` now contains quick install snippets to get installation up and running more quickly. We love ♥️ our users.

### 📘 Documentation

- Included documentation overview on basics of setup of signing for contributors needing it.
- Release process documented.
- 🎉 Charm's VHS project used for generation of landing images via script, aka a codified gif generation.

### 🤖 Development

- 🎉 Update `master` branch default for the repository to `main` to align with better industry inclusive naming practices.
- 🤖 Mage task automation contains additional helpers for cert installs for Apple, S3 Upload of artifacts.
- Trunk automation fully integrated now. Just run `trunk check --ci` to locally reproduce the exact checks the PR linting checks will do.

### 🚀 Continual Integration & Release Changes

- CI Matrix build no longer used, single agent building and releasing.
- CI pipelines refactored and using nearly identical tools via `aqua` tool, so local development and CI development is nearly equal now.
- CI testing pipelines for end to end and integration tests were split into their own independent pipelines.
- CI process is now fully containerized in ephemeral hosted agents, no longer expecting any environment setup.

### Build Specific Changes

- Apply basic steps on goreleaser templates for creating [reproducible builds](https://goreleaser.com/customization/build/#reproducible-builds).

### 🔨 Refactor

- The project go module has been renamed from `thy` to GitHub canonical name format `github.com/DelineaXPM/dsv-cli`.
  This will also allow better support for installing the latest version of cli via `go install github.com/DelineaXPM/dsv-cli@latest` as an option for those so so inclined.

### 🧪 Testing

- `mage test:integration` task added that checks all the required environment variables and flags to invoke much more easily locally and in CI.
- Unit tests run via gotestsum.
- Codecov integration for pull requests provide feedback on PR coverage changes on each new request.
- Testing is now able to be run on unit tests immediately.
  Integration tests now check for required environment variable `GO_INTEGRATION_TEST` to opt-in to tests, rather than requiring filtering out.
- Remove `fmt` blocking test. This is now covered by `golangci-lint` tooling run by trunk if required. Current tests flag vendor directory incorrectly.

### ⬆️ Dependencies

- Various upgrades and improvements via renovate.

### Known Issues & Workarounds

- Allowing binary to run if prompted by OS (only required when running a new version the first time).
  When possible this will be further improved, but until then just accept the prompt after installation and it should function as normal.
  - Smart Screen on windows may still prompt at this time for allowing binary to run the first time.
  - Gatekeeper on MacOS might alert as well, despite being signed, due to other requirements with Apple.

### Related

- fixes AB#469252 AB#448642
- related AB#452090

### Contributors

- [sheldonhull](https://github.com/sheldonhull)

## v1.39.0 - 2022-10-25

## Improvements

- No longer read/require configuration file for:
  - commands with --help provided , e.g. `dsv user create --help`.
  - version command, i.e. `dsv --version`.
  - top level command, i.e. `dsv`.
  - dummy commands that simply print its help message, e.g. `dsv breakglass` or `dsv pki`.
